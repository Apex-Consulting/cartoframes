{% macro createWidget(widget, id) -%}
  <section class="as-body">
      {% if widget.title %}
        <h1 class="as-m--0 as-font--medium">{{widget.title}}</h1>
      {% endif %}
      {% if widget.description %}
        <p class="as-m--0">{{widget.description}}</p>
      {% endif %}

      {% with id = id %}
        {% include 'viz/widgets/' + widget.type + '.html.j2' %}
      {% endwith %}

      {% if widget.footer %}
        <footer>{{widget.footer}}</footer>
      {% endif %}
  </section>
{%- endmacro %}

<div class="as-panel__element as-px--16 as-pt--8 as-pb--8" id="widgets">
  {% for layer in layers|reverse %}
    {% if layer.widgets %}
      {% set outer_loop = loop %}
        {% for widget in layer.widgets %}
          {{ createWidget(widget, 'layer%d_widget%d-%s' | format(outer_loop.index0, loop.index0, widget.name )) }}
        {% endfor %}
    {% endif %}
  {% endfor %}
</div>